# 常见问题

## fork 操作

1. 同步操作
2. 与内存量有关：内存越大，耗时越长（与机器类型有关）
3. info:latest_fork_usec: 上一次执行 fork 的微妙数

- 如何改善 fork

1. 优先使用物理机或者高效支持 fork 操作的虚拟化技术
2. 控制 redis 实例最大可用内存： maxmemory
3. 合理配置 Linux 内存分配策略： vm.overcommit_memory = 1
4. 降低 fork 频率： 例如放宽 AOF 重写自动触发时机，不不要的全量复制

## 进程外开销

1. CPU
   - 开销： RDB 和 AOF 文件生成，属于 CPU 密集型
   - 优化： 不做 CPU 绑定，不和 CPU 密集型部署
2. 内存
   - 开销： fork 内存开销，copy-on-write.
   - 优化： echo never > /sys/kernel/mm/transparent_hugepage/enabled
3. 硬盘
   - 开销： AOF 和 RDB 文件写入，可以结合 iostat, iotop 分析
   - 优化：
     - 1. 不要和高硬盘负载服务部署一起： 存储服务，消息队列等
     - 2. no-appendfsync-no-rewrite = yes
     - 3. 根据写入量决定磁盘类型：例如 ssd
     - 4. 单机多实例持久化文件目录，可以考虑分盘

## AOF 追加阻塞

## 单机多实例部署
